# B453 SMT ATE 耗材管控表导出格式标准说明

## 📋 总体要求

动态申请表管理系统导出的Excel文件必须严格按照 `TE課B453 SMT ATE 2025年7月份耗材管控表0623.xlsx` 的标准格式执行，确保与现有流程无缝衔接。

## 📊 标准表格结构

### 主表头布局
```
第1行：TE課B453 SMT ATE 2025年7月份耗材管控表 [合并A1:R1]
第2行：主表头（第一级）
第3行：子表头（第二级）
第4行开始：数据行
```

### 详细列定义

| 列 | 主表头 | 子表头 | 字段名 | 数据类型 | 示例值 |
|----|--------|--------|--------|----------|--------|
| A | 序號 | - | serial_number | 整数 | 1 |
| B | 物料描述 | - | material_description | 文本 | 設備耗材類-(B453/L&R FCT設備/探針/DB1639SAR-TSK1) |
| C | 單位 | - | unit | 文本 | pcs |
| D | 採購員 | - | purchaser | 文本 | 張三 |
| E | - | 單價(RMB) | unit_price | 数字(2位小数) | 9.82 |
| F | 安全庫存 | 最低 | min_safety_stock | 整数 | 228 |
| G | 安全庫存 | 最高 | max_safety_stock | 整数 | 512 |
| H | 最小採購量(MOQ) | - | moq | 整数 | 500 |
| I | L/T(Wks) | - | lead_time_weeks | 整数 | 2 |
| J | 2025年4月份明細 | 2025/4/1庫存 | apr_2025_stock | 整数 | 240 |
| K | 2025年5月份明細 | 2025年5月份需求 | may_2025_demand | 整数 | 500 |
| L | 2025年5月份明細 | 2025/5/22庫存 | may_2025_stock | 整数 | 200 |
| M | 2025年6月份明細 | 2025年6月份需求 | jun_2025_demand | 整数 | 500 |
| N | 2025年6月份明細 | 2025/6/23庫存 | jun_2025_stock | 整数 | 200 |
| O | 2025年7月份明細 | 2025年7月份需求 | jul_2025_demand | 整数 | 500 |
| P | 2025年7月份明細 | 2025/7/20庫存 | jul_2025_stock | 整数 | 500 |
| Q | - | 2025年8月份需求 | aug_2025_demand | 整数 | 500 |
| R | 備註 | - | remark | 文本 | 特殊说明 |

### 合并单元格规则

#### 第2行（主表头）合并规则：
- A2: 序號（不合并）
- B2: 物料描述（不合并）
- C2: 單位（不合并）
- D2: 採購員（不合并）
- E2: 空白（属于採購員合并）
- F2:G2: 安全庫存（合并F2:G2）
- H2: 最小採購量(MOQ)（不合并）
- I2: L/T(Wks)（不合并）
- J2:K2: 2025年4月份明細（合并J2:K2）
- L2:M2: 2025年5月份明細（合并L2:M2）
- N2:O2: 2025年6月份明細（合并N2:O2）
- P2:Q2: 2025年7月份明細（合并P2:Q2）
- R2: 備註（不合并）

## 💾 导出配置要求

### 文件格式
- **文件类型**: .xlsx (Excel 2007+)
- **编码**: UTF-8
- **工作表名称**: "B453耗材管控表"

### 单元格格式
```javascript
// 数字格式
单价: 保留2位小数，如 9.82
库存/需求: 整数，如 500
序号: 整数，如 1

// 文本格式
物料描述: 左对齐，自动换行
采购员: 居中对齐
单位: 居中对齐
备注: 左对齐，自动换行

// 表头格式
背景色: 浅灰色 (#F2F2F2)
字体: 加粗
对齐: 居中
边框: 全边框
```

### 列宽设置
```
A列(序號): 8字符
B列(物料描述): 50字符
C列(單位): 8字符
D列(採購員): 12字符
E列(單價): 12字符
F列(最低安全庫存): 12字符
G列(最高安全庫存): 12字符
H列(MOQ): 15字符
I列(L/T): 10字符
J-Q列(月度数据): 12字符
R列(備註): 20字符
```

## 🎯 关键要求

### 1. 数据完整性
- ✅ 必须包含所有18个标准列
- ✅ 序号必须连续且无重复
- ✅ 单价必须保留2位小数
- ✅ 所有必填字段不能为空

### 2. 格式一致性
- ✅ 表头必须采用多级结构
- ✅ 合并单元格必须按标准执行
- ✅ 日期格式统一为YYYY/M/D
- ✅ 数字对齐方式统一

### 3. 文件命名
```
标准格式: B453_SMT_ATE耗材管控表_YYYY-MM-DD.xlsx
实际示例: B453_SMT_ATE耗材管控表_2025-07-23.xlsx
```

## 🔧 技术实现要点

### Excel导出代码结构
```javascript
// 1. 创建工作簿
const wb = XLSX.utils.book_new();

// 2. 准备数据（包含多级表头）
const worksheetData = [
  // 主标题行
  ['TE課B453 SMT ATE 2025年7月份耗材管控表', '', '', ...],
  // 主表头行
  ['序號', '物料描述', '單位', '採購員', '', '安全庫存', '', ...],
  // 子表头行
  ['', '', '', '', '單價(RMB)', '最低', '最高', ...],
  // 数据行
  ...dataRows
];

// 3. 设置列宽
ws['!cols'] = [
  { wch: 8 },   // A列
  { wch: 50 },  // B列
  { wch: 8 },   // C列
  // ... 其他列
];

// 4. 设置合并单元格
ws['!merges'] = [
  { s: { r: 0, c: 0 }, e: { r: 0, c: 17 } }, // 标题行
  { s: { r: 1, c: 5 }, e: { r: 1, c: 6 } },  // 安全库存
  // ... 其他合并
];
```

### 数据校验规则
```javascript
// 必填字段校验
const requiredFields = [
  'serial_number', 'material_description', 'unit', 
  'purchaser', 'unit_price', 'min_safety_stock', 
  'max_safety_stock', 'moq', 'lead_time_weeks'
];

// 数据类型校验
const validateDataTypes = (item) => {
  return {
    serial_number: Number.isInteger(item.serial_number),
    unit_price: !isNaN(parseFloat(item.unit_price)),
    min_safety_stock: Number.isInteger(item.min_safety_stock),
    // ... 其他字段
  };
};
```

## 📋 质量检查清单

导出前必须检查：

- [ ] 表头结构是否正确（3行表头）
- [ ] 合并单元格是否按标准设置
- [ ] 所有18列是否都存在
- [ ] 数据格式是否正确（整数/小数）
- [ ] 列宽是否符合标准
- [ ] 文件命名是否规范
- [ ] 工作表名称是否正确
- [ ] 字体和对齐是否统一
- [ ] 边框和底色是否设置
- [ ] 数据完整性是否通过校验

## 🚨 常见问题及解决方案

### 问题1：合并单元格显示异常
**解决方案**：确保先创建数据，再设置合并单元格

### 问题2：中文字符显示乱码
**解决方案**：确保使用UTF-8编码保存

### 问题3：单价显示为整数
**解决方案**：设置单元格格式为数字，保留2位小数

### 问题4：列宽不正确
**解决方案**：手动设置`!cols`属性，单位为字符宽度

### 问题5：表头对齐不一致
**解决方案**：统一设置表头单元格的对齐方式为居中

---

**注意**: 此标准必须严格执行，任何偏差都可能影响后续数据处理流程。导出功能开发完成后，必须与标准文件进行详细对比验证。 