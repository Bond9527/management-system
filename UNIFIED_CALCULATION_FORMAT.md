# 🧮 统一计算格式实现文档

## 📋 概述

本文档详细说明了耗材管理系统中统一计算格式的实现，将原本分散的计算逻辑整合为一个统一的计算引擎。

## 🔧 统一计算引擎架构

### 核心接口设计

```typescript
// 通用计算参数接口
interface CalculationParams {
  monthlyCapacity: number;    // 当月产能
  usagePerSet: number;        // 每套机用量
  usageCount: number;         // 使用次数
  maxCapacity?: number;       // 最高产能 (可选)
  minCapacity?: number;       // 最低产能 (可选)
  currentStock?: number;      // 当前库存 (可选)
  unitPrice?: number;         // 单价 (可选)
}

// 计算结果接口
interface CalculationResult {
  monthlyDemand: number;      // 当月需求
  maxInventory?: number;      // 最高库存
  minInventory?: number;      // 最低库存
  netDemand?: number;         // 净需求
  demandValue?: number;       // 需求金额
}
```

### 🧮 核心计算公式

#### 1. 当月需求计算
```typescript
当月需求 = 当月产能 × 每套机用量 ÷ 使用次数
```

#### 2. 最高库存计算
```typescript
最高库存 = 最高产能 × 每套机用量 ÷ 使用次数
```

#### 3. 最低库存计算
```typescript
最低库存 = 最低产能 × 每套机用量 ÷ 使用次数
```

#### 4. 当月网路需求计算
```typescript
当月网路需求 = 当月需求 - 最低库存数量
```

#### 5. 需求金额计算
```typescript
需求金额 = 当月需求 × 单价(RMB)
```

## 🏭 系统实现对比

### 📊 实现前后对比

| 系统 | 实现前 | 实现后 | 改进效果 |
|------|--------|--------|----------|
| **B482申请表** | 手动输入所有数据 | 🆕 支持自动计算 | ⭐⭐⭐⭐⭐ |
| **Andor需求计算** | 独立计算函数 | 🔄 使用统一引擎 | ⭐⭐⭐⭐ |
| **B453管控表** | 手动数据管理 | 保持原有方式 | ⭐⭐ |
| **B453计算表** | 独立计算函数 | 🔄 使用统一引擎 | ⭐⭐⭐⭐ |

### 🎯 统一特性

1. **相同计算逻辑** - 所有系统使用相同的核心计算公式
2. **一致的公式格式** - 统一的数学表达式和变量命名
3. **统一的界面设计** - 一致的计算公式说明卡片
4. **标准化参数接口** - 统一的输入输出格式

## 🔄 各系统具体实现

### 1. B482申请表系统

#### 🆕 新增功能
- 添加计算参数字段：`usagePerSet`, `usageCount`, `monthlyCapacity`
- 新增自动计算开关：`enableAutoCalculation`
- 自动更新7月需求量和需求金额

#### 计算示例
```typescript
// 输入参数
usagePerSet: 18
usageCount: 30000
monthlyCapacity: 497700
unitPrice: 9.23

// 计算结果
当月需求 = 497700 × 18 ÷ 30000 = 299个
需求金额 = 299 × 9.23 = ¥2760.77
```

### 2. Andor需求计算系统

#### 🔄 改进实现
- 使用统一计算引擎替换原有独立函数
- 保持原有功能完整性
- 支持最高/最低库存计算

#### 计算示例
```typescript
// 输入参数
usagePerSet: 4
usageCount: 100000
monthlyCapacity: 497700
maxCapacity: 694000
minCapacity: 445000

// 计算结果
当月需求 = 497700 × 4 ÷ 100000 = 20个
最高库存 = 694000 × 4 ÷ 100000 = 28个
最低库存 = 445000 × 4 ÷ 100000 = 18个
```

### 3. B453 SMT ATE系统

#### 🔄 计算表改进
- 使用统一计算引擎
- 支持当月需求和网路需求计算
- 产能基准：363,000

#### 计算示例
```typescript
// 输入参数
usagePerSet: 21
usageCount: 50000
monthlyCapacity: 363000
minStock: 29

// 计算结果
当月需求 = 363000 × 21 ÷ 50000 = 152个
当月网路需求 = 152 - 29 = 123个
```

## 🎨 界面统一设计

### 计算公式说明卡片

所有系统都采用统一的渐变背景设计：

```tsx
{/* 🧮 统一计算公式说明 */}
<Card className="bg-gradient-to-r from-[color1] to-[color2]">
  <CardBody>
    <h3 className="text-lg font-semibold mb-3 text-blue-800">
      🧮 統一計算公式 - [系统名称]
    </h3>
    <div className="grid grid-cols-1 md:grid-cols-[n] gap-4 text-sm">
      {/* 公式卡片 */}
    </div>
  </CardBody>
</Card>
```

### 颜色方案

- **B482系统**: `from-blue-50 to-purple-50`
- **Andor系统**: `from-green-50 to-blue-50`
- **B453系统**: `from-purple-50 to-blue-50`

## 📈 实现效果

### ✅ 成功达成目标

1. **计算逻辑统一** - 所有系统使用相同的核心算法
2. **公式格式一致** - 统一的数学表达式展示
3. **界面设计统一** - 一致的视觉风格和布局
4. **代码复用性高** - 减少重复代码，提高维护性

### 🚀 用户体验提升

1. **学习成本降低** - 用户只需掌握一套计算逻辑
2. **操作一致性** - 所有系统的操作方式相似
3. **错误率减少** - 统一的计算引擎减少计算错误
4. **功能完整性** - B482系统新增自动计算功能

### 🔧 技术优势

1. **代码维护性** - 集中化的计算逻辑便于维护
2. **扩展性强** - 新增系统可直接使用统一引擎
3. **测试覆盖** - 集中测试核心计算逻辑
4. **版本一致** - 所有系统同步更新计算规则

## 🎯 未来扩展方向

1. **计算规则配置化** - 支持动态配置计算参数
2. **历史数据分析** - 基于统一格式的数据分析
3. **智能预测** - 使用机器学习优化需求预测
4. **多语言支持** - 扩展到其他语言环境

---

## 📝 总结

通过实施统一计算格式，我们成功地：

1. **整合了分散的计算逻辑**为一个统一的计算引擎
2. **提升了用户体验**通过一致的界面和操作方式
3. **提高了代码质量**通过减少重复和提高复用性
4. **增强了系统功能**为B482系统添加了自动计算能力

这一改进为耗材管理系统的长期发展奠定了坚实的技术基础！ 