# 耗材固定单价功能实现

## 概述

本次更新为耗材管理系统添加了固定单价功能，使系统能够跟踪每个耗材的单价信息，并计算库存总价值。这为成本管理和财务分析提供了重要支持。

## 功能特性

### ✨ 新增功能
- **固定单价字段**: 每个耗材都有固定的单价（元）
- **库存总价值计算**: 自动计算每个耗材的库存总价值
- **总价值统计**: 在仪表盘和库存总览中显示库存总价值
- **单价显示**: 在相关页面中显示单价信息
- **CSV导出增强**: 导出数据包含单价和总价值信息

### 🎯 应用场景
- **成本管理**: 了解库存资产价值
- **财务分析**: 评估库存投资回报
- **采购决策**: 基于价值进行采购优先级排序
- **库存优化**: 识别高价值库存项目

## 技术实现

### 1. 数据结构更新

#### SupplyItem 接口更新
```typescript
export interface SupplyItem {
  id: number;
  name: string;
  category: string;
  unit: string;
  currentStock: number;
  safetyStock: number;
  unitPrice: number; // 新增：固定单价（元）
}
```

#### 初始数据更新
为所有现有耗材添加了合理的单价信息：
- 探针类: ¥120-220/支
- 清洁剂: ¥25-45/瓶
- 继电器: ¥15-35/个
- 连接器: ¥28-32/个
- 其他配件: ¥0.50-450/个

### 2. 页面更新

#### 库存总览页面 (`/supplies/inventory-overview`)
- **表格增强**: 添加单价和总价值列
- **统计摘要**: 新增库存总价值卡片
- **CSV导出**: 包含单价和总价值信息

```typescript
// 新增工具函数
const formatPrice = (price: number): string => {
  return `¥${price.toFixed(2)}`;
};

const calculateTotalValue = (supplies: SupplyItem[]): number => {
  return supplies.reduce((total, supply) => {
    return total + (supply.currentStock * supply.unitPrice);
  }, 0);
};
```

#### 耗材详情页面 (`/supplies/details/:id`)
- **基本信息**: 显示单价和库存总价值
- **布局调整**: 从3列调整为4列布局

#### 新增记录页面 (`/supplies/add-record`)
- **表单增强**: 新增耗材时包含单价输入
- **验证逻辑**: 添加单价验证规则
- **接口更新**: NewSupplyForm 和 NewSupplyErrors 接口

#### 仪表盘页面 (`/dashboard`)
- **统计卡片**: 新增库存总价值统计
- **布局调整**: 从4列调整为5列布局

### 3. 数据管理

#### 数据一致性
- 保持现有的数据一致性检查功能
- 单价字段不影响库存计算逻辑
- 确保向后兼容性

#### 存储机制
- 单价信息存储在 localStorage 中
- 与现有耗材数据一起管理
- 支持数据导入导出

## 用户界面更新

### 表格显示
```
| 耗材名称 | 分类 | 单位 | 单价 | 当前库存 | 总价值 | 安全库存 | 库存状态 |
|---------|------|------|------|----------|--------|----------|----------|
| P1000探针 | 探针 | 支 | ¥150.00 | 25 | ¥3,750.00 | 20 | 库存充足 |
```

### 统计卡片
- **库存总价值**: 显示所有耗材的总价值
- **格式化显示**: 使用 ¥ 符号和两位小数
- **颜色区分**: 使用不同颜色区分不同类型的统计

### 表单输入
- **单价输入**: 数字类型输入框
- **验证规则**: 必须为正数
- **错误提示**: 清晰的错误信息

## 数据示例

### 耗材数据示例
```typescript
{
  id: 1,
  name: "P1000探针",
  category: "探针",
  unit: "支",
  currentStock: 25,
  safetyStock: 20,
  unitPrice: 150.00
}
```

### 计算示例
```typescript
// 单个耗材总价值
const itemValue = supply.currentStock * supply.unitPrice;
// 25 * 150.00 = ¥3,750.00

// 库存总价值
const totalValue = supplies.reduce((total, supply) => {
  return total + (supply.currentStock * supply.unitPrice);
}, 0);
```

## 文件修改清单

### 核心文件
1. **`src/hooks/useSupplies.ts`**
   - 更新 SupplyItem 接口
   - 添加单价到初始数据

2. **`src/context/SuppliesContext.tsx`**
   - 更新 SupplyItem 接口
   - 添加单价到初始数据

### 页面文件
3. **`src/pages/supplies/inventory-overview.tsx`**
   - 添加单价和总价值列
   - 新增总价值统计卡片
   - 更新 CSV 导出功能

4. **`src/pages/supplies/details.tsx`**
   - 添加单价和总价值显示
   - 调整布局为4列

5. **`src/pages/supplies/add-record.tsx`**
   - 添加单价输入字段
   - 更新表单验证逻辑
   - 更新接口定义

6. **`src/pages/dashboard.tsx`**
   - 添加库存总价值统计卡片
   - 调整布局为5列

## 使用指南

### 查看单价信息
1. 访问库存总览页面
2. 在表格中查看"单价"列
3. 点击耗材名称查看详细信息

### 添加新耗材
1. 访问新增记录页面
2. 点击"新增耗材"按钮
3. 填写所有必填字段，包括单价
4. 点击"创建"按钮

### 导出数据
1. 在库存总览页面点击"导出"按钮
2. 选择"导出CSV"
3. 下载的文件包含单价和总价值信息

## 注意事项

### 数据迁移
- 现有数据会自动添加默认单价
- 建议根据实际情况调整单价
- 单价修改不影响历史记录

### 性能考虑
- 总价值计算是实时进行的
- 对于大量数据，可考虑缓存计算结果
- 导出功能包含完整的价格信息

### 兼容性
- 保持与现有功能的完全兼容
- 不影响现有的库存管理逻辑
- 支持所有现有的数据操作

## 未来扩展

### 可能的功能增强
1. **价格历史**: 跟踪单价变化历史
2. **成本分析**: 基于价格的成本分析报告
3. **采购建议**: 基于价值的采购优先级
4. **财务集成**: 与财务系统的集成
5. **多币种支持**: 支持不同货币的单价

### 报表功能
1. **价值报表**: 按类别、时间等维度的价值统计
2. **成本趋势**: 价格变化趋势分析
3. **投资回报**: 库存投资回报率分析

## 总结

本次更新成功为耗材管理系统添加了固定单价功能，提供了完整的成本管理支持。通过合理的界面设计和数据管理，用户可以轻松地：

- 查看每个耗材的单价和总价值
- 了解整体库存的资产价值
- 在新增耗材时设置合理的单价
- 导出包含价格信息的完整数据

这为后续的财务分析和成本管理奠定了坚实的基础。 