# Excel导出行隐藏功能测试说明

## 功能概述

本系统已实现Excel导出时包含隐藏耗材数据的功能。被隐藏的耗材数据会包含在Excel中，但对应的行会被设置为隐藏状态。

## 测试步骤

### 1. 添加测试数据

在每个表格中，都有一个"添加測試隱藏數據"按钮：

- **B482表格**：点击"添加測試隱藏數據"按钮，会添加一个名为"🧪 测试隐藏耗材"的隐藏项目
- **Andor表格**：点击"添加測試隱藏數據"按钮，会添加一个名为"🧪 测试隐藏耗材"的隐藏项目

### 2. 验证隐藏状态

- 添加测试数据后，该项目在前端表格中会显示为半透明状态（opacity-50 bg-gray-50）
- 点击"顯示已隱藏項目"按钮可以切换显示/隐藏状态

### 3. 导出Excel测试

1. 添加测试隐藏数据
2. 点击"導出Excel"按钮
3. 打开导出的Excel文件
4. 检查控制台输出，应该看到类似以下信息：

```
🔍 开始设置B482行隐藏，总数据项数: X
🔍 B482数据项隐藏状态: [{id: xxx, material: "🧪 测试隐藏耗材", isHidden: true}]
🔒 隐藏B482行 1: 🧪 测试隐藏耗材 (ID: xxx)
🔒 行对象设置: {hpt: 0, hidden: true}
📊 B482总共隐藏了 1 行
🔍 B482行设置: [{hpt: 25}, {hpt: 0, hidden: true}]
🔍 B482隐藏的行索引: [1]
🔍 验证隐藏行数量: 1
🔍 验证隐藏行详情: [{hpt: 0, hidden: true}]
```

### 4. Excel中的效果

在导出的Excel文件中：
- 所有数据都存在（包括隐藏的测试数据）
- 被隐藏的行在Excel中是折叠/隐藏状态
- 用户可以通过Excel的行展开功能查看这些隐藏的数据

## 技术实现

### 行隐藏设置

```typescript
// 设置隐藏属性
if (ws['!rows']![rowIndex]) {
  ws['!rows']![rowIndex].hidden = true;
  // 设置行高为0（另一种隐藏方式）
  ws['!rows']![rowIndex].hpt = 0;
}
```

### 数据包含策略

```typescript
// 数据行 - 包含所有数据（包括隐藏的），通过Excel行隐藏来控制显示
...b482Data.map((item) => [
  item.serialNumber,
  item.materialDescription,
  // ... 其他字段
]),
```

## 支持的表格

- ✅ B482耗材管控申請表
- ✅ Andor耗材需求计算表  
- ✅ B453 SMT ATE耗材管控表
- ✅ B453耗材需求计算表

## 注意事项

1. 行隐藏功能依赖于XLSX库的支持
2. 不同版本的Excel可能对行隐藏的显示效果略有不同
3. 隐藏的行在Excel中仍然存在，只是视觉上被隐藏
4. 数据完整性得到保证，不会丢失任何信息

## 故障排除

如果行隐藏功能不工作：

1. 检查控制台输出，确认隐藏设置是否成功
2. 验证数据项的`isHidden`属性是否正确设置
3. 确认XLSX库版本是否支持行隐藏功能
4. 尝试在不同的Excel版本中打开文件 